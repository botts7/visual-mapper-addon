<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="0.0.34">
    <meta name="app-version" content="0.4.0-beta.3.5">
    <title>Welcome to Visual Mapper - Setup Wizard</title>
    <link rel="stylesheet" href="css/styles.css?v=0.4.0-beta.3.5">
    <style>
        /* Onboarding-specific styles */
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .onboarding-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            overflow: hidden;
        }

        .onboarding-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .onboarding-header h1 {
            margin: 0 0 10px 0;
            font-size: 32px;
        }

        .onboarding-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 16px;
        }

        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: white;
            transition: width 0.3s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
            padding: 10px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #999;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: #667eea;
            color: white;
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: #4caf50;
            color: white;
        }

        .step.completed .step-number::after {
            content: '‚úì';
        }

        .step-label {
            font-size: 12px;
            color: #999;
            transition: color 0.3s ease;
        }

        .step.active .step-label {
            color: #667eea;
            font-weight: 600;
        }

        .step.completed .step-label {
            color: #4caf50;
        }

        .onboarding-content {
            padding: 40px;
            min-height: 400px;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }

        .step-description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .onboarding-actions {
            display: flex;
            justify-content: space-between;
            padding: 20px 40px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        .btn {
            padding: 12px 32px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Connection method cards */
        .connection-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .method-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .method-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .method-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .method-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .method-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .method-description {
            font-size: 14px;
            color: #666;
        }

        /* Form styles */
        .form-group {
            margin-bottom: 24px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Status messages */
        .status-message {
            padding: 16px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .status-message.success {
            background: #e8f5e9;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }

        .status-message.error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }

        .status-message.info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
        }

        .status-message.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Device list */
        .device-list {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin: 20px 0;
        }

        .device-item {
            padding: 16px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .device-item:last-child {
            border-bottom: none;
        }

        .device-item:hover {
            background: #f8f9fa;
        }

        .device-item.selected {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success animation */
        .success-icon {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #4caf50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin: 0 auto 24px;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        .text-center {
            text-align: center;
        }

        .mt-4 {
            margin-top: 24px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="onboarding-container">
        <!-- Header -->
        <div class="onboarding-header">
            <h1>Welcome to Visual Mapper</h1>
            <p>Android device monitoring and automation for Home Assistant</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">Welcome</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">Connect Device</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Test Connection</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">Security</div>
            </div>
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">Complete</div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="onboarding-content">
            <!-- Step 1: Welcome -->
            <div class="step-content active" id="step1">
                <h2 class="step-title">Let's get started!</h2>
                <p class="step-description">
                    Visual Mapper lets you monitor and control Android devices through Home Assistant.
                    This quick setup wizard will help you connect your first device.
                </p>

                <div style="background: #f0f4ff; padding: 24px; border-radius: 12px; margin: 24px 0;">
                    <h3 style="margin-top: 0; color: #667eea;">What you'll need:</h3>
                    <ul style="color: #666; line-height: 1.8;">
                        <li>Android device connected to the same network</li>
                        <li>ADB (Wireless Debugging) enabled on your device</li>
                        <li>Device IP address (we can scan for it!)</li>
                    </ul>
                </div>

                <div class="status-message info show">
                    <strong>First time setup</strong><br>
                    This wizard will guide you through connecting your first device. You can add more devices later from the Devices page.
                </div>
            </div>

            <!-- Step 2: Connect Device -->
            <div class="step-content" id="step2">
                <h2 class="step-title">Connect Your Android Device</h2>
                <p class="step-description">
                    Choose how you'd like to find your device. We recommend scanning for the easiest setup.
                </p>

                <div class="connection-methods">
                    <div class="method-card" id="methodScan" onclick="selectMethod('scan')">
                        <div class="method-icon">üîç</div>
                        <div class="method-title">Scan Network</div>
                        <div class="method-description">Automatically find devices on your network</div>
                    </div>
                    <div class="method-card" id="methodManual" onclick="selectMethod('manual')">
                        <div class="method-icon">‚å®Ô∏è</div>
                        <div class="method-title">Manual Entry</div>
                        <div class="method-description">Enter IP address and port manually</div>
                    </div>
                </div>

                <!-- Scan Results (hidden by default) -->
                <div id="scanResults" class="hidden">
                    <h3>Found Devices:</h3>
                    <div class="device-list" id="deviceList"></div>
                </div>

                <!-- Manual Entry Form (hidden by default) -->
                <div id="manualForm" class="hidden">
                    <div class="form-group">
                        <label for="connectionType">Connection Type</label>
                        <select id="connectionType" style="width: 100%; padding: 12px 16px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px;">
                            <option value="tcp">TCP/IP - Legacy (Port 5555)</option>
                            <option value="wireless">Wireless ADB - Android 11+ (Port 5555)</option>
                            <option value="pairing">Wireless Pairing - Android 11+ (Port varies)</option>
                            <option value="tls">TLS/Secure ADB (Custom Port)</option>
                        </select>
                    </div>

                    <!-- TCP/IP and Wireless ADB Config -->
                    <div id="tcpConfig">
                        <div class="form-group">
                            <label for="deviceIp">Device IP Address</label>
                            <input type="text" id="deviceIp" placeholder="192.168.1.100">
                        </div>
                        <div class="form-group">
                            <label for="devicePort">ADB Port</label>
                            <input type="number" id="devicePort" value="5555" placeholder="5555">
                        </div>
                    </div>

                    <!-- Pairing Config (Android 11+) -->
                    <div id="pairingConfig" class="hidden">
                        <div style="background: #e3f2fd; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="margin: 0; color: #1565c0; line-height: 1.6;">
                                <strong>Android 11+ Wireless Pairing:</strong><br>
                                1. Settings ‚Üí Developer Options ‚Üí Wireless debugging<br>
                                2. Tap "Pair device with pairing code"<br>
                                3. You'll see TWO ports - enter BOTH below along with the 6-digit code
                            </p>
                        </div>

                        <div class="form-group">
                            <label for="pairingCode">Pairing Code (6-digit)</label>
                            <input type="text" id="pairingCode" placeholder="123456" maxlength="6">
                        </div>

                        <div class="form-group">
                            <label for="pairingHost">Device IP Address</label>
                            <input type="text" id="pairingHost" placeholder="192.168.1.2">
                        </div>

                        <div class="form-group">
                            <label for="pairingPort">Pairing Port</label>
                            <input type="number" id="pairingPort" placeholder="37899">
                        </div>

                        <div class="form-group">
                            <label for="connectionPort">Connection Port</label>
                            <input type="number" id="connectionPort" placeholder="45441">
                        </div>
                    </div>

                    <!-- Wireless Config Info -->
                    <div id="wirelessConfig" class="hidden">
                        <div style="background: #e3f2fd; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="margin: 0; color: #1565c0; line-height: 1.6;">
                                <strong>Wireless ADB Setup (Android 11+):</strong><br>
                                1. Enable Developer Options on your Android device<br>
                                2. Go to Settings ‚Üí Developer Options ‚Üí Wireless debugging<br>
                                3. Tap "Wireless debugging" to enable it<br>
                                4. Note the IP address and port shown (e.g., 192.168.1.100:5555)
                            </p>
                        </div>
                    </div>

                    <!-- TLS Config Info -->
                    <div id="tlsConfig" class="hidden">
                        <div style="background: #fff3cd; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                            <p style="margin: 0; color: #856404; line-height: 1.6;">
                                <strong>TLS/Secure ADB:</strong><br>
                                Advanced secure connection with certificate authentication.<br>
                                Requires pre-configured certificates on both client and device.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="status-message" id="step2Status"></div>
            </div>

            <!-- Step 3: Test Connection -->
            <div class="step-content" id="step3">
                <h2 class="step-title">Testing Connection...</h2>
                <p class="step-description">
                    Please wait while we verify the connection to your device.
                </p>

                <div class="text-center mt-4">
                    <div class="spinner" style="width: 60px; height: 60px; border-width: 6px; border-color: #e0e0e0; border-top-color: #667eea;"></div>
                    <p style="margin-top: 24px; color: #666;">Connecting to device...</p>
                </div>

                <div class="status-message" id="step3Status"></div>
            </div>

            <!-- Step 4: Security Setup -->
            <div class="step-content" id="step4">
                <h2 class="step-title">Configure Device Security</h2>
                <p class="step-description">
                    Choose how Visual Mapper should handle your device's lock screen during automation.
                </p>

                <div id="securityConfigContainer">
                    <!-- Security config UI will be injected here by device-security.js -->
                </div>

                <div class="status-message" id="step4Status"></div>
            </div>

            <!-- Step 5: Complete -->
            <div class="step-content" id="step5">
                <div class="text-center">
                    <div class="success-icon">‚úì</div>
                    <h2 class="step-title">Setup Complete!</h2>
                    <p class="step-description">
                        Your device is connected and ready to use.
                    </p>

                    <div style="background: #f0f4ff; padding: 24px; border-radius: 12px; margin: 32px 0; text-align: left;">
                        <h3 style="margin-top: 0; color: #667eea;">Next Steps:</h3>
                        <ul style="color: #666; line-height: 2;">
                            <li><strong>Create Sensors:</strong> Go to Sensors page to capture data from your device</li>
                            <li><strong>Build Flows:</strong> Automate sensor collection with scheduled flows</li>
                            <li><strong>View in Home Assistant:</strong> Your sensors will appear automatically via MQTT</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Actions -->
        <div class="onboarding-actions">
            <button class="btn btn-secondary" id="btnBack" onclick="previousStep()" style="display: none;">
                ‚Üê Back
            </button>
            <div id="skipContainer">
                <button class="btn btn-secondary" onclick="skipOnboarding()">
                    Skip Setup
                </button>
            </div>
            <button class="btn btn-primary" id="btnNext" onclick="nextStep()">
                Get Started ‚Üí
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { initApp, getApiBase } from './js/init.js?v=0.0.5';

        // Initialize app first
        await initApp();

        // Make getApiBase globally available
        window.API_BASE = getApiBase();

        // Now load onboarding module
        const { OnboardingWizard } = await import('./js/modules/onboarding.js?v=0.0.5');

        // Initialize wizard
        window.wizard = new OnboardingWizard();
        await wizard.init();

        // Expose functions globally for onclick handlers
        window.selectMethod = (method) => wizard.selectConnectionMethod(method);
        window.nextStep = () => wizard.nextStep();
        window.previousStep = () => wizard.previousStep();
        window.skipOnboarding = () => wizard.skip();
    </script>
</body>
</html>
